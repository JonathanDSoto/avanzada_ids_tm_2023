<html>
    <head>
        <style>
            canvas{
                background-color: white;
            }
            body{
                background-color: black;
            }
        </style>
    </head>
    <body>
        <center>
            <canvas width="500" height="500" id="myCanvas"></canvas>
        </center>

        <img style="display: none;" src="como.png" id="my_image" alt="">

        <script>
            var canvas = document.getElementById('myCanvas');
            var ctx = canvas.getContext('2d');
            var dir = 0; 
            var w_x=100, w_y=70;
            var speed = 10; 
            let walls = [];
            let pause = false;
            let score = 0;
            let image = new Image(50,50);
            image.src = "policia.png";

            let audio = new Audio();
            audio.src = "mario-bros-vida.mp3";

            class Rectangulo{

                constructor(x,y,w,h,c){
                    this.x = x;
                    this.y = y;
                    this.w = w;
                    this.h = h;
                    this.c = c; 
                }

                paint(ctx){

                    ctx.fillStyle = this.c;
                    ctx.fillRect (this.x, this.y, this.w, this.h);
                    ctx.strokeRect (this.x, this.y, this.w, this.h);

                }

                seTocan(target){
                    
                    if(this.x < target.x + target.w &&  
                       this.x + this.w > target.x   &&    
                       this.y < target.y + target.h &&   
                       this.y + this.h > target.y)
                        {
                            return true;
                        }
                    return false;
                }

            }
            const player = new Rectangulo(255, 255,50,50,"black");
            const target = new Rectangulo(350, 350,40,40,"black");
            
            walls.push(new Rectangulo(100, 70,280,30,"gray"));
            walls.push(new Rectangulo(100, 420,280,30,"gray"));
            
            document.addEventListener("keydown", (e) =>{

                switch(e.keyCode)
                {
                    case 87:
                        if (!pause) dir = e.keyCode; 
                    break;
                    case 83:
                        if (!pause) dir = e.keyCode;
                    break;
                    case 68:
                        if (!pause) dir = e.keyCode;
                    break;
                    case 65:
                        if (!pause) dir = e.keyCode;
                    break;
                    case 32:
                        pause = !pause;
                    break;

                }  

            })

            function update()
            {
                if(!pause){

                
                    switch( dir )
                    {
                        case 87: 
                            player.y -= speed;
                            if( player.y < -50 ){ player.y = 550 }
                        break;
                        case 83: 
                            player.y += speed;
                            if( player.y > 550 ){ player.y = 0 }
                        break;
                        case 68: 
                            player.x += speed;
                            if( player.x > 550 ){ player.x = 0 }
                        break;
                        case 65: 
                            player.x -= speed;
                            if( player.x < -50 ){ player.x = 550 }
                        break;

                    }  

                    if (player.seTocan(target)) {
                        target.x = Math.random() * (460);
                        target.y = Math.random() * (460);
                        speed += 1; 
                        score += 10;

                        audio.play();
                    } 

                    for (var i = walls.length - 1; i >= 0; i--) {
                        

                        if( player.seTocan(walls[i]) )
                        {    
                            
                            switch( dir )
                            {
                                case 87:
                                    player.y += speed;
                                break;
                                case 83:
                                    player.y -= speed;
                                break;
                                case 68:
                                    player.x -= speed;
                                break;
                                case 65:
                                    player.x += speed;
                                break;

                            } 
                            dir = 0;
                        }
                    }

                
                }

                repaint(); 
                window.requestAnimationFrame(update);
            }

            function repaint()
            {

                if(!pause){
                    ctx.fillStyle = "white";
                    ctx.fillRect (0, 0, 500, 500);

                    ctx.font = "20px Verdana";
                    ctx.fillStyle = "black";
                    ctx.fillText("SCORE:"+score,20,20);

                    player.c = random_rgba();
                    //player.paint(ctx)
                    ctx.drawImage(image, player.x, player.y,50,50); 

                    target.paint(ctx) 

                    for (var i = walls.length - 1; i >= 0; i--) {
                        walls[i].paint(ctx)
                    }
                }else{

                    ctx.fillStyle = "rgba(154,160,154,0.020)";
                    ctx.fillRect (0, 0, 500, 500);

                    ctx.font = "30px Verdana";
                    ctx.fillStyle = "black";
                    ctx.fillText("P A U S E",180,230);

                }
            }   
            

            window.requestAnimationFrame = (function () {
                return window.requestAnimationFrame ||
                    window.webkitRequestAnimationFrame ||
                    window.mozRequestAnimationFrame ||
                    function (callback) {
                        window.setTimeout(callback, 17);
                    };
            }());

            window.requestAnimationFrame(update);

            /*var color = "rgba(13,242,23,0.5)";
            var figura = true;
            var press = false;

            ctx.fillStyle = color;
 
            canvas.addEventListener("click", (e) => {

                if (figura){ 
                
                    ctx.beginPath();
                    ctx.arc(e.layerX, e.layerY, 50, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.stroke();
                }else{

                    ctx.fillRect (e.layerX-50, e.layerY-50, 100, 100);
                    ctx.strokeRect (e.layerX-50, e.layerY-50, 100, 100);
                }
            })

            canvas.addEventListener("mouseover", (e)=> {

                console.log("mouseover")

                color = random_rgba();
                ctx.fillStyle = color;
            })

            canvas.addEventListener('mouseout', (e)=>{

                figura = !figura; 
                
            })

            canvas.addEventListener("mousemove", (e)=>{
                console.log("mousemove")

                if(press){ 
               
                    ctx.beginPath();
                    ctx.arc(e.layerX, e.layerY, 2, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.stroke();
                }
            })

            canvas.addEventListener("mousedown", (e)=>{
                press = true;
            })

            canvas.addEventListener("mouseup", (e)=>{
                press = false;
            })

            */

            function random_rgba() {
                var o = Math.round, r = Math.random, s = 255;
                return 'rgba(' + o(r()*s) + ',' + o(r()*s) + ',' + o(r()*s) + ',' + r().toFixed(1) + ')';
            }

            /*ctx.fillStyle = "#F96646";
            ctx.fillRect (10, 10, 55, 50);

            ctx.fillStyle = "rgba(0, 0, 200, 0.5)";
            ctx.fillRect (30, 30, 55, 50);

            ctx.strokeStyle = "red";

            ctx.beginPath();
            ctx.moveTo(185,10);
            ctx.lineTo(222,65); 
            ctx.lineTo(125,65);
            ctx.fill();
            ctx.closePath();

            ctx.beginPath();

            ctx.moveTo(222,65);
            ctx.lineTo(272,125);
            ctx.stroke();
            ctx.closePath();

            ctx.fillStyle = "green";

            ctx.beginPath();
            ctx.arc(135, 110, 22, 0, 2 * Math.PI);
            ctx.fill();
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(185, 110, 22, 0, 2 * Math.PI);
            ctx.stroke();

            ctx.fillStyle = "white";
            ctx.font = "40px Arial"
            ctx.fillText("Hola mundo",250,40);

            ctx.strokeStyle = "green";
            ctx.strokeText("Hola mundo",252,42);
            
            var grd = ctx.createLinearGradient(140,170,200,100);
            grd.addColorStop(0,"#F24B0D");
            grd.addColorStop(0.1,"#F20DE1");
            grd.addColorStop(1,"#29F20D");

            ctx.fillStyle = grd;
            ctx.fillRect(140,170,200,100);

            var grd2 = ctx.createRadialGradient(240, 320, 5, 255, 340, 100);
            grd2.addColorStop(0,"#F24B0D");
            grd2.addColorStop(0.5,"#F20DE1");
            grd2.addColorStop(1,"#29F20D");

            ctx.fillStyle = grd2;
            ctx.fillRect(140,270,200,100)

            var img = document.getElementById("my_image")
            ctx.drawImage(img,340,70,80,80)*/
        </script>
    </body>
</html>